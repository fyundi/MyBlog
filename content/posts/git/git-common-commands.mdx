---
title: "Git常用命令详解"
date: "2024-12-20"
category: "tools"
tags: ["Git", "版本控制", "命令", "开发工具"]
description: "详细介绍Git常用命令，包括clone、submodule、ignore、提交规范、代理设置等实用技巧"
featured: true
---

# Git常用命令详解

## 概述

本文档整理了Git开发中常用的命令和技巧，包括仓库克隆、子模块管理、文件忽略、提交规范等实用内容。

## 仓库克隆

### 基础克隆

```bash
git clone <repository-url>
```

### 浅克隆（Shallow Clone）

只克隆最近的提交历史，节省时间和空间：

```bash
# 只克隆最近1次提交
git clone --depth 1 <repository-url>

# 只克隆最近10次提交
git clone --depth 10 <repository-url>

# 克隆指定分支的浅克隆
git clone --depth 1 --branch main <repository-url>
```

**使用场景**：
- 大型仓库，只需要最新代码
- CI/CD环境，不需要完整历史
- 节省克隆时间和存储空间

### 克隆后获取完整历史

如果浅克隆后需要完整历史：

```bash
# 取消浅克隆限制
git fetch --unshallow

# 或者获取所有分支的完整历史
git fetch --unshallow --all
```

## 子模块管理（Submodule）

### 添加子模块

```bash
# 添加子模块
git submodule add <repository-url> <path>

# 示例：添加子模块到 libs 目录
git submodule add https://github.com/user/library.git libs/library
```

### 克隆包含子模块的仓库

```bash
# 方法1：递归克隆（推荐）
git clone --recursive <repository-url>

# 方法2：先克隆主仓库，再初始化子模块
git clone <repository-url>
git submodule init
git submodule update

# 方法3：一条命令完成
git submodule update --init --recursive
```

### 更新子模块

```bash
# 更新所有子模块到最新提交
git submodule update --remote

# 更新特定子模块
git submodule update --remote libs/library

# 更新并合并子模块的更改
git submodule update --remote --merge
```

### 子模块常用操作

```bash
# 查看子模块状态
git submodule status

# 进入子模块目录进行操作
cd libs/library
git checkout main
git pull

# 返回主仓库，提交子模块更新
cd ../..
git add libs/library
git commit -m "chore: 更新子模块到最新版本"

# 删除子模块
git submodule deinit libs/library
git rm libs/library
rm -rf .git/modules/libs/library
```

## .gitignore 文件管理

### 创建 .gitignore

```bash
# 创建全局 .gitignore
touch ~/.gitignore_global
git config --global core.excludesfile ~/.gitignore_global
```

### 常用 .gitignore 规则

```bash
# 操作系统文件
.DS_Store
Thumbs.db
*.swp
*.swo
*~

# IDE 文件
.idea/
.vscode/
*.sublime-project
*.sublime-workspace

# 编译产物
*.class
*.o
*.so
*.dll
*.exe
dist/
build/
bin/
out/

# 依赖目录
node_modules/
vendor/
venv/
env/
.venv/

# 日志文件
*.log
logs/
*.log.*

# 环境变量文件
.env
.env.local
.env.*.local

# 临时文件
*.tmp
*.temp
.cache/
```

### 忽略已跟踪的文件

如果文件已经被Git跟踪，需要先移除：

```bash
# 从Git中移除但保留本地文件
git rm --cached <file>

# 移除整个目录
git rm -r --cached <directory>

# 然后添加到 .gitignore
echo "<file>" >> .gitignore
git add .gitignore
git commit -m "chore: 添加忽略文件"
```

### 检查忽略规则

```bash
# 检查文件是否被忽略
git check-ignore -v <file>

# 查看所有被忽略的文件
git status --ignored
```

## 提交信息规范

### 约定式提交（Conventional Commits）

```bash
# 新功能
git commit -m "feat: 添加用户登录功能"

# 修复bug
git commit -m "fix: 修复登录验证问题"

# 文档更新
git commit -m "docs: 更新API文档"

# 代码重构
git commit -m "refactor: 重构用户服务类"

# 性能优化
git commit -m "perf: 优化数据库查询性能"

# 测试相关
git commit -m "test: 添加登录功能单元测试"

# 构建相关
git commit -m "build: 更新构建脚本"

# 持续集成
git commit -m "ci: 更新CI配置"

# 样式修改
git commit -m "style: 格式化代码"

# 撤销修改
git commit -m "revert: 撤销之前的提交"

# 其他
git commit -m "chore: 更新依赖版本"
```

### 提交类型说明

| 类型 | 说明 | 示例 |
|------|------|------|
| feat | 新功能 | feat: 添加用户注册功能 |
| fix | 修复bug | fix: 修复登录验证问题 |
| docs | 文档更新 | docs: 更新README |
| style | 代码格式（不影响功能） | style: 格式化代码 |
| refactor | 代码重构 | refactor: 重构用户服务 |
| perf | 性能优化 | perf: 优化查询性能 |
| test | 测试相关 | test: 添加单元测试 |
| build | 构建系统 | build: 更新webpack配置 |
| ci | CI配置 | ci: 更新GitHub Actions |
| chore | 其他更改 | chore: 更新依赖 |
| revert | 撤销提交 | revert: 撤销某次提交 |

## 分支管理

### 查看分支

```bash
# 查看本地分支
git branch

# 查看远程分支
git branch -r

# 查看所有分支
git branch -a

# 查看分支跟踪关系
git branch -vv
```

### 创建和切换分支

```bash
# 创建新分支
git branch <branch-name>

# 创建并切换到新分支
git checkout -b <branch-name>

# 使用新语法（Git 2.23+）
git switch -c <branch-name>

# 切换到已存在的分支
git checkout <branch-name>
# 或
git switch <branch-name>
```

### 删除分支

```bash
# 删除本地分支
git branch -d <branch-name>

# 强制删除本地分支
git branch -D <branch-name>

# 删除远程分支
git push origin --delete <branch-name>
```

## 远程仓库操作

### 查看远程仓库

```bash
# 查看远程仓库列表
git remote -v

# 查看远程仓库详细信息
git remote show origin
```

### 添加远程仓库

```bash
# 添加远程仓库
git remote add <name> <url>

# 示例
git remote add upstream https://github.com/original/repo.git
```

### 推送和拉取

```bash
# 推送到远程
git push origin <branch-name>

# 推送所有分支
git push --all origin

# 推送标签
git push --tags

# 拉取更新
git pull origin <branch-name>

# 只拉取不合并
git fetch origin
```

## 代理设置

### 设置代理

```bash
# HTTP代理
git config --global http.proxy http://127.0.0.1:7890
git config --global https.proxy http://127.0.0.1:7890

# SOCKS5代理
git config --global http.proxy socks5://127.0.0.1:1080
git config --global https.proxy socks5://127.0.0.1:1080

# 只对特定域名设置代理
git config --global http.https://github.com.proxy http://127.0.0.1:7890
```

### 取消代理

```bash
# 取消全局代理
git config --global --unset http.proxy
git config --global --unset https.proxy

# 取消特定域名代理
git config --global --unset http.https://github.com.proxy
```

### 查看代理配置

```bash
# 查看所有配置
git config --global --list

# 查看特定配置
git config --global http.proxy
```

## 常用操作技巧

### 撤销更改

```bash
# 撤销工作区更改（未add）
git checkout -- <file>

# 撤销暂存区更改（已add）
git reset HEAD <file>

# 撤销最近一次提交（保留更改）
git reset --soft HEAD~1

# 撤销最近一次提交（不保留更改）
git reset --hard HEAD~1
```

### 查看历史

```bash
# 查看提交历史
git log

# 简洁模式
git log --oneline

# 图形化显示
git log --graph --oneline --all

# 查看文件更改历史
git log --follow <file>

# 查看某行的更改历史
git blame <file>
```

### 暂存更改

```bash
# 暂存当前更改
git stash

# 暂存并添加说明
git stash save "说明信息"

# 查看暂存列表
git stash list

# 恢复暂存
git stash pop

# 应用暂存但不删除
git stash apply

# 删除暂存
git stash drop stash@{0}
```

### 标签管理

```bash
# 创建标签
git tag v1.0.0

# 创建带注释的标签
git tag -a v1.0.0 -m "版本1.0.0"

# 查看标签
git tag

# 推送标签
git push origin v1.0.0

# 推送所有标签
git push --tags

# 删除标签
git tag -d v1.0.0
git push origin --delete v1.0.0
```

## 配置管理

### 用户配置

```bash
# 设置用户名和邮箱
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# 查看配置
git config --global user.name
git config --global user.email
```

### 常用配置

```bash
# 设置默认编辑器
git config --global core.editor "code --wait"

# 设置默认分支名
git config --global init.defaultBranch main

# 启用颜色输出
git config --global color.ui auto

# 设置推送策略
git config --global push.default simple

# 设置自动换行处理
git config --global core.autocrlf input  # Linux/Mac
git config --global core.autocrlf true    # Windows
```

## 总结

掌握这些Git常用命令，能够大大提高开发效率。建议根据实际项目需求，灵活运用这些命令和技巧。

## 参考资料

- [Git官方文档](https://git-scm.com/doc)
- [约定式提交规范](https://www.conventionalcommits.org/zh-hans/)
- [Git Submodule文档](https://git-scm.com/book/zh/v2/Git-工具-子模块)
